var ARK={};ARK.TEKTONIK="http://127.0.0.1:5001/v1_0",ARK.Form=Backbone.View.extend({events:{"click .save":"save"},initialize:function(options){this.dom={},this.dom.form=this.$el.find("form"),this.dom.errors=this.$el.find(".errors"),this.save_callback=options.save_callback},save:function(e){e.preventDefault();var data=this.dom.form.serializeJSON(),model=new ARK.Property;model.save(data,{wait:!0,success:this.save_success,error:this.save_error,context:this})},save_success:function(model,resp,options){var scope=options.context;scope.collection.add(model.attributes.record),scope.resetForm(),ARK.Messenger(model.attributes.message),void 0!==scope.save_callback&&scope.save_callback()},save_error:function(model,xhr,options){options.context.resetErrors(),options.context.renderErrors(xhr.responseJSON.errors)},resetForm:function(){return this.dom.form.trigger("reset"),this.resetErrors(),this.dom.form},resetErrors:function(){return this.dom.errors.empty(),this.dom.form.find("*").removeClass("error"),this.dom.errors},renderErrors:function(errors){var that=this;return _.each(errors,function(error,key){var field=that.dom.form.find('[name="'+key+'"]');field.addClass("error"),_.each(error,function(msg){that.dom.errors.append("<li>"+msg+"</li>")})}),that.dom.errors}}),ARK.FormView=Backbone.View.extend({save_error:function(model,xhr,options){options.context.resetErrors(xhr.responseJSON.errors)},resetForm:function(){this.dom.form.trigger("reset"),this.dom.errors.empty(),this.dom.form.find("*").removeClass("error")},resetErrors:function(errors){var that=this;this.dom.errors.empty(),this.dom.form.find("*").removeClass("error"),_.each(errors,function(error,key){var field=that.dom.form.find('[name="'+key+'"]');field.addClass("error"),_.each(error,function(msg){that.dom.errors.append("<li>"+msg+"</li>")})})}}),ARK.Log=function(){console&&console.log.apply(console,arguments)},ARK.Messenger=function(){console&&console.log.apply(console,arguments)},ARK.Prompt=function(message){var p=prompt(message);return p},ARK.pubsub=_.extend({},Backbone.Events),ARK.Template=function(source,data){var template=_.template(source),compiled=template(data);return compiled},ARK.Dashboard_page=Backbone.Router.extend({routes:{"":"page"},initialize:function(){Backbone.history.start()},page:function(){}}),ARK.Properties_page_list=Backbone.Router.extend({routes:{"":"list"},initialize:function(){var listCollection=new ARK.Properties,listView=new ARK.Properties_part_list({collection:listCollection}),createView=new ARK.Form({collection:listCollection,el:".properties_part_create"});this.listCollection=listCollection,this.listView=listView,this.createView=createView,Backbone.history.start()},list:function(){this.listCollection.fetch({reset:!0})}}),ARK.Properties_page_update=Backbone.Router.extend({routes:{"":"update"},initialize:function(args){var model=new ARK.Property({id:args.id}),view=new ARK.Form({model:model}),update=new ARK.Properties_part_update({model:model});this.model=model,this.view=view,this.update=update,Backbone.history.start()},update:function(){this.model.fetch({reset:!0})}}),ARK.Properties_part_list_item=Backbone.View.extend({tagName:"li",className:"properties_part_list_item",events:{"click .delete":"delete"},"delete":function(){return this.remove(),this.model.destroy({wait:!0}),this},render:function(){var template=ARK.Template(ARK.Properties_piece_list_item,this.model.toJSON());return this.$el.html(template),this}}),ARK.Properties_part_list=Backbone.View.extend({el:".properties_part_list",items:{},initialize:function(){this.collection.bind("reset",this.addAll,this),this.collection.bind("add",this.addOne,this),this.collection.bind("error",this.error,this)},error:function(model,xhr){var message=void 0===xhr.responseJSON?"There was an error":xhr.responseJSON.error;ARK.Messenger(message)},addOne:function(model){var config={model:model},item=new ARK.Properties_part_list_item(config);return this.renderItem(item),this.items[model.cid]=item,item},addAll:function(){this.$el.empty(),_.each(this.collection.models,this.addOne,this)},renderItem:function(item){this.$el.append(item.render().el)},render:function(){return this}}),ARK.Properties_part_update=ARK.FormView.extend({el:".properties_part_update",events:{"click .save":"save","click .edit":"render_edit","click .cancel":"render"},initialize:function(){this.dom={},this.dom.form=this.$el.find("form"),this.dom.form_property=this.$el.find('[name="property"]'),this.dom.errors=this.$el.find(".errors"),this.dom.property=this.$el.find(".property"),this.dom.edit_button=this.$el.find(".edit"),this.model.bind("change",this.render,this)},render_edit:function(e){e.preventDefault(),this.dom.form.show(),this.dom.form_property.focus(),this.dom.property.hide(),this.dom.edit_button.hide()},render:function(){var property=this.model.get("property");return this.dom.property.html(property),this.dom.form_property.val(property),this.dom.errors.empty(),this.dom.form.hide(),this.dom.property.show(),this.dom.edit_button.show(),this},save:function(e){e.preventDefault();var that=this,form=this.$el.find("form"),that=this,data=form.serializeJSON(),success=function(){ARK.Messenger("Property updated"),that.render()};this.model.save(data,{wait:!0,success:success,error:this.save_error,context:this})}}),ARK.Properties_piece_list_item='<a href="/properties/<%= id %>"><%= property %></a> / <a class="delete">delete</a>',ARK.Properties_piece_update_form="<form>",ARK.Properties_piece_update_form+='<input name="id" type="hidden" value="<%= id %>"/>',ARK.Properties_piece_update_form+='<input name="property" type="text" value="<%= property %>" placeholder="property"/>',ARK.Properties_piece_update_form+='<input type="submit" value="save" class="save"/>',ARK.Properties_piece_update_form+="</form>",ARK.Property=Backbone.Model.extend({urlRoot:ARK.TEKTONIK+"/properties",parse:function(response){var hasResult=void 0!==response.result;return hasResult?response.result:response}}),ARK.Properties=Backbone.Collection.extend({url:ARK.TEKTONIK+"/properties",model:ARK.Property,parse:function(response){return response.result}});
//# sourceMappingURL=scripts.min.js.map